

<!-- Meanless: Transportation Research Part C 139 (2022) 103696 Contents lists available at ScienceDirect Transportation Research Part C ELSEVIER journal homepage: www.elsevier.com/locate/trc updates Keywords: Transport disruption Response planning Urban rail transit Bus deployment Robust optimization-->

# Real-time dispatching of operating buses during unplanned disruptions to urban rail transit system

Xiaohan Wang ${}^{a}$ ,Jian Gang Jin ${}^{a, * }$ ,Lijun Sun ${}^{b}$

${}^{a}$ School of Naval Architecture,Ocean & Civil Engineering,and State Key Laboratory of Ocean Engineering,Shanghai Jiao Tong University, Shanghai 200240, China

${}^{\mathrm{b}}$ Department of Civil Engineering,McGill University,Montreal,Quebec H3A 0C3,Canada

## ARTICLEINFO

## A B S T R A C T

Unplanned disruptions to urban rail systems can result in widespread confusion and severe delays, and running bus bridging service is a common solution. Currently, transit operators usually adopt experience-based response strategy in such a way that spare buses from bus terminals and parking lots are used to run bus bridging services. Such a response approach can be effective when there are spare buses available at nearby terminals/parking lots. However, in case spare buses are not available or enough, it could be beneficial to dispatch running buses from nearby operating bus lines to ensure efficient response while incurring minimal inconvenience to on-board passengers. While this approach could reduce metro users' delays, it causes extra delays and dissatisfaction to affected bus riders. In this study, we investigate the optimal bus dispatching problem for responding to unplanned disruptions of urban rail transit system with two bus fleet sources: (1) spare buses at terminals and parking lots, and (2) running buses from nearby operating bus lines. To obtain the optimal dispatching scheme, we develop an integer programming model, which achieves a balance between the delays of metro users and that of bus riders. Considering of the high uncertainty of bus headways which could affect the performance of the above deterministic model, we further develop a robust optimization model to obtain more reliable bus dispatching schemes. Case studies based on the data sets in Shanghai are conducted. The results demonstrate that our approach can be carried out in real-time, and employing running buses from operating bus lines shows great potential in reducing affected users' delays. In addition, the robust model offers a more reliable and competitive solution when the headway varies widely.

## 1. Introduction

In the context of vigorously developing public transport, urban rail transit serves as the backbone of the public transport system, offering efficient service to large numbers of residents (Lane, 2008; Currie and Muir, 2017; Kang et al., 2019). Under the high-intensity operation, disruptions to urban rail occur frequently (Gu et al., 2018). According to statistics, a total of 83 unplanned disruptions occurred on the Shanghai Metro in the past year. Such unplanned interruptions incur great economic losses to the metro operators, and metro users suffers a lot from extensive delays (Bates et al., 2001). What is worse, users' confidence in the metro service is inevitably weakened.

In response to unplanned disruptions, managers generally use a "bus bridging" strategy, where disrupted rail segments are connected by temporarily added bus routes and the unaffected segments continue to serve passengers by rail (Kepaptsoglou and Karlaftis, 2009). Currently, the bus bridging service is supported by spare buses that are from nearby bus parking lots or terminals of bus routes. This approach alleviates effectively the delays of rail users when there are spare buses and drivers available at nearby parking lots or terminals. Unfortunately, in fact, spare buses and drivers are often not enough, and moreover, parking lots and terminals may be far away, resulting in much time wasted on the way to the target locations.

---

<!-- Footnote -->

* Corresponding author.

E-mail address: jiangang.jin@sjtu.edu.cn (J.G. Jin).

<!-- Footnote -->

---

<!-- Meanless: https://doi.org/10.1016/j.trc.2022.103696 Received 14 September 2021; Received in revised form 3 January 2022; Accepted 13 April 2022 Available online 26 April 2022 0968-090X/(C) 2022 Elsevier Ltd. All rights reserved.-->




<!-- Meanless: X. Wang et al. Transportation Research Part C 139 (2022) 103696-->

An effective bus dispatching method is critical to bus bridging service. In practice, it is found that the load factor of buses is low in Shanghai, which is common in many cities. Thus, to ensure an efficient response, it could be beneficial to dispatch running buses from nearby operating bus lines. However, running buses' real-time response reduce the delays of stranded passengers at the cost of the effected bus riders and we need to make a trade-off. In addition, with hundreds of buses in the network, it is almost impossible to get the optimal dispatching scheme in a short time by enumeration alone. Therefore, a mathematical model should be established to solve the real-time dispatching problem.

In this study, we investigate the optimal bus dispatching problem for responding to unplanned disruptions of urban rail transit systems with two bus fleet sources: spare buses at terminals and parking lots and running buses from nearby operating bus lines. The main contributions of this paper consist of the following: (a) To solve the bus dispatching problem, we develop a mathematical method that achieves the balance between the recovery efficiency of rail service and the disturbance degree of the bus riders. (b) Taking the unplanned disruption of Shanghai Metro as an example, numerical experiments are carried out to demonstrate the computational feasibility and effectiveness of the proposed method.

With respect to (a), the method involves three key features. First, to solve this dynamic optimization problem, we build a real-time bus scheduling framework based on the rolling horizon strategy, where the dispatching scheme is updated constantly according to the real-time data. Second, an integer programming model accurately identifies the optimal scheme and the most effective combination of running buses and spare buses. Third, based on the robustness theory, a robust optimization model is developed to provide a feasible dispatching scheme when the headway of operating buses is uncertain.

Regarding (b), the numerical results of the actual case suggest the following: the method can significantly reduce the total delay for the users involved. Additionally, the arrival time of the first shuttle bus is dramatically shortened, which triggers the rapid activation of the emergency response scheme. Meanwhile, the robust optimization model enhances the reliability and the resilience of the solution. Furthermore, our method is more efficiently solved and fully satisfies the need for rapid response.

The remainder of this paper is organized as follows. Section 2 provides a brief introduction and summary of the relevant literature. Sections 3 and 4 describe the problem of bus dispatching in the event of unexpected disruptions to urban rail transit. Furthermore, two mathematical models are proposed: a deterministic model and a robust optimization model. Section 5 applies the method to a practical case, conducts numerical experiments, as well as analyzes the results. Section 6 concludes the whole paper and gives insight to the future work.

## 2. Literature review

The problem of emergency response in urban rail transit has been widely addressed in the transportation research literature. Pender et al. (2014) conclude that bus bridging is the most common way to deal with disruptions, through semi-structured interviews with 48 rail organizations from different countries. De-Los-Santos et al. (2012) study the robustness of the rail users with and without shuttle buses to evaluate the effectiveness of the bus bridging service. Research efforts concerned with bus bridging have made valuable contributions, such as behavior analysis and passenger assignment, or line planning (Zhang et al., 2021).

Behavior analysis and passenger assignment are the basis for the emergency response. Behavior analysis focuses on passen performance perceptions throughout the disruption, which helps us to judge the priority of various strategies and assess the availability of methods (Leng and Corman, 2020; Li et al., 2020). Eltved et al. (2021) propose a novel methodology based on smart card data for analyzing the impacts of long-term disruptions on passenger travel behavior. Tan et al. (2020) develop the disutility-based multi-modal traffic model to explicitly estimate the number of affected metro passengers transferring to the urban bus system during the disruption. Meanwhile, some scholars develop dynamic passenger assignment models that make valuable contributions to estimating the demand for feeder buses (Zhu and Goverde, 2019; Binder et al., 2017).

Route planning for shuttle buses is a major issue in the literature relating to bus bridging (Guihaire and Hao, 2008). Traditionally, the bus route is planned along a path parallel to the broken part of the railway line, that is, the shuttle bus stops at each disrupted station from the start to the end (Wang et al., 2019). Dou et al. (2019) propose a parallel shuttle bus service design problem with station congestion consideration and develop a mixed-integer nonlinear programming model to determine optimal routing. From the perspective of the users, rapid shuttle buses should be dedicated to special stations with high passenger flows, like interchange stations (Gu et al., 2018). In particular, Jin et al. (2016) introduce a novel route design problem with additional routes for bus bridging services and develop a column generation algorithm and a path-based multicommodity network flow model to solve the problem. Liang et al. (2019) further extend the route planning model by considering bus travel time uncertainty and develop a robust optimization model to obtain more reliable schemes. Chen and An (2021) propose an integrated optimization framework to solve the bridging route planning and bus timetabling problem simultaneously. From the literature, we find that the design of shuttle bus routes hardly considers the source of vehicles.

Currently, transit operators usually deploy spare vehicles to serve as shuttle buses. Pender et al. (2015) discuss the economic feasibility of employing standby vehicles with a practical survey. Unfortunately, a large number of vehicles are required to evacuate stranded passengers during the initial period of unplanned disruption, but there are rarely enough drivers and standby buses (Diab and Shalaby, 2018). Therefore, Hou et al. (2020) construct a framework to dispatch spare vehicles first, and if not enough, then dispatch buses from the terminals of the surrounding bus lines. Similarly, Itani et al. (2020) develop an optimization model for the bus dispatching problem with the objective of minimizing total delays for metro and bus users and propose a genetic algorithm to obtain solutions in any given scenario. However, when terminals are far from the disrupted metro stations, dispatching buses from terminals will make the waiting time of stranded passengers so long that the bus bridge service cannot be implemented effectively. Moreover, they ignore the demand of the stranded passengers for shuttle buses, and their bus dispatching method fails to cope well with unplanned disruptions as all buses are dispatched to a single station. In the early stages of unplanned disruptions, stranded passengers are not uniformly distributed across the metro stations, and several stations contain large numbers of stranded passengers, which are referred to as "special disrupted stations" in this paper and require many buses. In general, previous researches have failed to consider at least two critical issues: (a) delays associated with metro passengers waiting for shuttle buses to arrive, and (b) buses assignment based on the demand of stranded passengers. Our study presents an effort to narrow the aforementioned gaps.

<!-- Meanless: 2-->




<!-- Meanless: X. Wang et al. Transportation Research Part C 139 (2022) 103696-->

In this paper, we propose a real-time bus dispatching approach to solve the problem of vehicle source and task assignment for bus bridging services. In this way, several running buses from nearby operating bus lines are dispatched to metro stations to share bus bridging tasks with spare buses. It fully takes into account the context of the event in the reality and quickly extricates the victims from the recovery dilemma.

## 3. Real-time dispatching of operating buses

In this section, the problem of bus dispatching in the event of an unplanned urban rail disruption is defined initially. Then, we propose a framework for solving the problem. Thirdly, to obtain the optimal dispatching scheme, an integer programming model is formulated.

### 3.1. Problem statement

To maintain an effective bus bridging service, we propose a real-time bus dispatching method based on the passenger demand, where the running buses from nearby operating bus lines and the standby buses in the parking lots share the task of bus bridging. It consists of three main steps, with the framework is shown in Fig. 1. (a) Generate the candidate bus route set. (b) Input relevant data consisting of the location and load factor of the candidate buses. (c) Address the vehicle assignment problem. Bus dispatching is a dynamic optimization problem, where the input data changes and the dispatching plan is adjusted accordingly. The rolling horizon strategy is widely used to solve dynamic scheduling problems (Zhu and Goverde, 2021; Gkiotsalitis and van Berkum, 2020; Meng and Zhou, 2011; Peeta and Mahmassani, 1995). Its characteristic is that a series of local scheduling within short time windows distributing among the timeline replace global scheduling. Fig. 2 shows the real-time bus dispatching process based on rolling horizon,where the bus dispatching scheme is updated every period of $T$ . Specifically,the updating process is to re-run steps (b) and (c) for the remaining buses (excluding buses that have already been dispatched in the previous stage) to get the new dispatching scheme. Therefore, we focus on rapidly generating the optimal dispatching scheme based on real-time available data. There are already some proven methods for the first two steps (Lei et al., 2021; Hamedmoghadam et al., 2021; Boeing, 2017), and step (c) is the main work to be done in this paper.

The vehicle assignment problem aims to minimize overall travel delays experienced by both metro passengers directly affected by the disruption and the bus riders of the chosen bus routes. Although dispatching a running bus to a metro station as a shuttle bus reduces the waiting time for metro passengers, the original passengers on the bus and those who are about to sequentially take this bus along the route must wait for another upcoming bus as a result. To reduce the delay of bus users, when a running bus is dispatched, it can either drive directly to the metro station for the bus bridging service, or finish its pre-designated trip first and then arrive at the target metro station. Therefore, the bus dispatching problem needs to achieve a balance between the delay of metro users and that of bus riders, and the vehicle assignment problem is a combinatorial optimization problem. It involves five main decisions: (a) which disrupted metro station each bus should be dispatched to; (b) the bus bridging task assignment using spare and running buses in various scenarios; (c) which bus of each route should be dispatched as a shuttle bus; (d) whether the running bus finishes its pre-designated trip before providing the bus bridging service; (e) the optimal number of shuttle buses. As mentioned in Section 2, at the very beginning of the unplanned disruptions, the demand for buses at special disrupted stations is significant. Consequently, special disrupted stations are identified as departure stations for shuttle buses, and all buses will be dispatched there. In practice, there are two main categories of them, either disrupted stations with stalled trains or stations connecting sections that can be operated normally.

The four remaining decisions can be represented as a network graph (Fig. 3). There is an unplanned disruption to the metro line, resulting in five metro stations being out of service and requiring bus bridging services. As mentioned earlier, two of the five stations are special disrupted station, and the node indicates the location of buses and stations. The dashed line illustrates all bus dispatching options from three bus routes and a bus parking lot to two special disrupted stations. As more bus routes are added, the scale of the problem grows larger, and it is hardly possible to solve a large-scale combinatorial optimization problem like the vehicle assignment problem by enumerating all options. Hence, it is necessary to build a mathematical model for obtaining the optimal dispatching plan.

### 3.2. Assumptions and notations

The model developed in this paper is based on the following assumptions: (a) All buses are of the same technical parameters and performance features. (b) If a running bus is dispatched directly to the metro station for the service, all passengers on the bus get off and take the next bus. (c) The parking berth capacity at the exit of the special disrupted station is large enough to overlook the queuing delays caused by multiple buses arriving at the same time.

The notation used in this paper is presented in Table 1.

<!-- Meanless: 3-->




<!-- Meanless: X. Wang et al. Transportation Research Part C 139 (2022) 103696-->

<!-- Media -->

<!-- figureText: Generate the candidate bus route set Input data Address the vehicle assignment problem Searching the shortest path Special disrupted stations Bun network Urban rail network Road network data Bus selection model Identifying special disrupted stations _____。 (a) (b) Bus data (c) (d) Finding bus routes -->

<img src="https://cdn.noedgeai.com/bo_d2u6glbef24c73b31eng_3.jpg?x=165&y=159&w=1376&h=546&r=0"/>

Fig. 1. Framework of real-time bus dispatching.

<!-- figureText: Bus ${T}_{\text{start }}^{f}$ : the start time of the $f$ -th dispatch ${T}_{end}^{f}$ : the end time of the $f$ -th dispatch ${\widetilde{T}}_{end}^{f}$ : the end time of executing the $f$ -th dispatching plan ${T}_{S}$ : the time window for each dispatch $T$ : the cycle of dispatch $D$ : the time window for the last dispatch ${b}_{\text{start }}^{g}$ : the start time of the $g$ -th bus executing the dispatching plan ${b}_{end}^{g}$ : the end time of the $g$ -th bus finishing the dispatching plan : the travel time of the bus already been dispatched $\supset$ : the travel time of the bus to be dispatched FTime ${T}_{end}^{3}$ $\left( {{T}_{\text{start }}^{2} + {T}_{S}}\right)$ $\left( {{T}_{\text{start }}^{3} + {T}_{S}}\right)$ Stage 3 Stage 2 Stage ${b}_{\text{end }}^{1}{T}_{\text{start }}^{2}{\widetilde{T}}_{\text{end }}^{1}$ ${T}_{\text{start }}^{3}{\widetilde{T}}_{\text{end }}^{2}$ ${T}_{end}^{1}$ ${T}_{en}^{2}$ $\left( {{T}_{\text{start }}^{1} + T}\right)$ $\left( {{T}_{\text{start }}^{1} + {2T}}\right)$ $\left( {{T}_{\text{start }}^{1} + {T}_{S}}\right)$ -->

<img src="https://cdn.noedgeai.com/bo_d2u6glbef24c73b31eng_3.jpg?x=183&y=797&w=1343&h=398&r=0"/>

Fig. 2. The real-time bus dispatching process based on rolling horizon.

<!-- figureText: Route 2 Route 3 Urban rail stations Disrupted stations Special disrupted stations Bus parking lot Bus stops Bus Bus network Urban rail network Disrupted urban rail segment 口 Route 1 Upbound -->

<img src="https://cdn.noedgeai.com/bo_d2u6glbef24c73b31eng_3.jpg?x=358&y=1292&w=988&h=801&r=0"/>

Fig. 3. Network representation.

<!-- Meanless: 4-->




<!-- Meanless: X. Wang et al. Transportation Research Part C 139 (2022) 103696-->

Table 1

The notation used in this paper.

<table><tr><td>Notation</td><td>Descriptions</td></tr><tr><td colspan="2">Sets</td></tr><tr><td>$I$</td><td>Set of candidate bus routes, $I = \{ 1,\ldots ,n\}$</td></tr><tr><td>$L$</td><td>Set of bus parking lots, $L = \left\{  {1,\ldots ,{n}_{l}^{ * }}\right\}$</td></tr><tr><td>${J}_{i}$</td><td>Set of buses operating in the bus route $i,{J}_{i} = \left\{  {1,\ldots ,{N}_{i}}\right\}$</td></tr><tr><td>${J}_{i}^{ * }$</td><td>Set of replicas of buses operating in the bus route $i,{J}_{i}^{ * } = \left\{  {1,\ldots ,{N}_{i}^{ * }}\right\}$</td></tr><tr><td>$K$</td><td>Set of special disrupted stations, $K = \{ 1,\ldots ,m\}$</td></tr><tr><td colspan="2">Parameters</td></tr><tr><td>${c}_{ij}$</td><td>Number of passengers on board the bus $j$ of the bus route $i$ ,when the deployment scheme is operated</td></tr><tr><td>${q}_{ij}$</td><td>Number of passengers that a bus $j$ may have to serve at subsequent stops within a trip cycle, ${}^{\mathrm{a}}$ when the deployment scheme is operated</td></tr><tr><td>${Q}_{ij}$</td><td>The total number of passengers served by the bus $j$ in a trip cycle when the deployment scheme is operated, with the value estimated by the 85th percentile of historical data</td></tr><tr><td>${a}_{ij}$</td><td>Number of passengers already been served by the bus $j$ in a trip cycle, when the deployment scheme is operated</td></tr><tr><td>${c}_{i}$</td><td>The total number of passengers per hour served by the bus route $i$ when the deployment scheme is operated, with the value estimated by the 85th percentile of historical data</td></tr><tr><td>${p}^{k}$</td><td>Number of passengers requiring "bus bridging" service at the special disrupted station $k$</td></tr><tr><td>${t}_{ij}^{k}$</td><td>Travel time of the bus $j$ of the bus route $i$ to the special disrupted station $k$ (min)</td></tr><tr><td>${\widetilde{t}}_{ij}^{k}$</td><td>Travel time of the bus $j$ of the bus route $i$ to the terminal first and then to the special disrupted station $k$ (min)</td></tr><tr><td>${\tau }_{l}^{k}$</td><td>Travel time of the bus parking lot $l$ to the special disrupted station $k$ (min)</td></tr><tr><td>${h}_{ij}$</td><td>Departure interval between the bus $j$ of the bus route $i$ and the next bus $j + 1$ (min)</td></tr><tr><td>${c}_{t}$</td><td>Number of passengers that can be evacuated per shuttle bus</td></tr><tr><td>${c}_{\max }$</td><td>Maximum full capacity per bus</td></tr><tr><td>${h}_{\max }$</td><td>Maximum average headway of a bus route (min)</td></tr><tr><td>$\alpha$</td><td>Guaranteed parameter for the capacity of the remaining regular buses</td></tr><tr><td>$\beta$</td><td>Guaranteed parameter for bus capacity in the bus bridging services</td></tr><tr><td>$\lambda$</td><td>Weighting parameter for bus passengers delay</td></tr><tr><td>$\gamma$</td><td>Penalty parameter for passengers who cannot board a bus by the time limit</td></tr><tr><td colspan="2">Decision variables</td></tr><tr><td>${x}_{ij}^{k}$</td><td>${x}_{ij}^{k} \in  \{ 0,1\} ,1$ if the bus $j$ of the bus route $i$ arrives at the special disrupted station $k$ ,and 0 otherwise</td></tr><tr><td>${\widetilde{x}}_{ij}^{k}$</td><td>${\widetilde{x}}_{ij}^{k} \in  \{ 0,1\} ,1$ if the replica of the bus $j$ of the bus route $i$ arrives at the special disrupted station $k$ ,and 0 otherwise</td></tr><tr><td>${w}_{l}^{k}$</td><td>Integer variable,the number of buses from the bus parking lot $l$ arrives at the special disrupted station $k$</td></tr></table>

${}^{a}$ Note: A bus travels once from its origin to its destination according to its operating route,which is called a "trip cycle".

<!-- Media -->

### 3.3. Integer programming model

As mentioned earlier, when a running bus is dispatched, it can either go straight to the metro station for the bus bridging service, or arrive at the terminal to finish its designated trip first and then provide the service. To develop a linear model, we make a "replica" of each running bus, and this decision can be described as dispatching the bus or its replica. If its replica is dispatched, it means that this bus drive to the terminal first and then to the metro station as a shuttle bus. With the notation defined above, the integer linear programming model is formulated as follows:

$$
\min \;\lambda \mathop{\sum }\limits_{{k \in  K}}\mathop{\sum }\limits_{{i \in  I}}\mathop{\sum }\limits_{{j \in  {J}_{i}}}\left( {{c}_{ij} + {q}_{ij}}\right) {h}_{ij}{x}_{ij}^{k} + \mathop{\sum }\limits_{{k \in  K}}\mathop{\sum }\limits_{{i \in  I}}\mathop{\sum }\limits_{{j \in  {J}_{i}}}{c}_{t}{t}_{ij}^{k}{x}_{ij}^{k} + \mathop{\sum }\limits_{{k \in  K}}\mathop{\sum }\limits_{{i \in  I}}\mathop{\sum }\limits_{{j \in  {J}_{i}^{ * }}}{c}_{t}{\widetilde{t}}_{ij}^{k}{\widetilde{x}}_{ij}^{k} \tag{1}
$$

$$
 + \mathop{\sum }\limits_{{k \in  K}}\mathop{\sum }\limits_{{l \in  L}}{c}_{t}{\tau }_{l}^{k}{w}_{l}^{k} + \gamma \mathop{\sum }\limits_{{k \in  K}}{\delta }^{k}
$$

subject to

$$
\mathop{\sum }\limits_{{k \in  K}}\left( {{x}_{ij}^{k} + {x}_{i,j + 1}^{k}}\right)  \leq  1,\forall i \in  I,\forall j \in  {J}_{i} \smallsetminus  \left\{  {N}_{i}\right\}   \tag{2}
$$

$$
\mathop{\sum }\limits_{{k \in  K}}\left( {{\widetilde{x}}_{ij}^{k} + {\widetilde{x}}_{i,j + 1}^{k}}\right)  \leq  1,\forall i \in  I,\forall j \in  {J}_{i}^{ * } \smallsetminus  \left\{  {N}_{i}^{ * }\right\}   \tag{3}
$$

$$
\mathop{\sum }\limits_{{k \in  K}}\left( {{\widetilde{x}}_{ij}^{k} + {x}_{i,j + 1}^{k}}\right)  \leq  1,\forall i \in  I,\forall j \in  {J}_{i}^{ * } \smallsetminus  \left\{  {N}_{i}^{ * }\right\}   \tag{4}
$$

<!-- Meanless: 5-->




<!-- Meanless: X. Wang et al. Transportation Research Part C 139 (2022) 103696-->

$$
\mathop{\sum }\limits_{{k \in  K}}\mathop{\sum }\limits_{{j \in  {J}_{i}}}{x}_{ij}^{k} + \mathop{\sum }\limits_{{k \in  K}}\mathop{\sum }\limits_{{j \in  {J}_{i}^{ * }}}{\widetilde{x}}_{ij}^{k} + \frac{\mathop{\sum }\limits_{{j \in  {J}_{i}}}{h}_{ij}}{{h}_{\max }} \leq  {N}_{i},\forall i \in  I \tag{5}
$$

$$
{c}_{\max }\left( {{N}_{i} - \mathop{\sum }\limits_{{k \in  K}}\mathop{\sum }\limits_{{j \in  {J}_{i}}}{x}_{ij}^{k} - \mathop{\sum }\limits_{{k \in  K}}\mathop{\sum }\limits_{{j \in  {J}_{i}^{ * }}}{\widetilde{x}}_{ij}^{k}}\right)  \geq  \alpha {c}_{i},\forall i \in  I \tag{6}
$$

$$
{c}_{\max }\left( {\mathop{\sum }\limits_{{i \in  I}}\mathop{\sum }\limits_{{j \in  {J}_{i}}}{x}_{ij}^{k} + \mathop{\sum }\limits_{{i \in  I}}\mathop{\sum }\limits_{{j \in  {J}_{i}^{ * }}}{\widetilde{x}}_{ij}^{k} + \mathop{\sum }\limits_{{l \in  L}}{w}_{l}^{k}}\right)  \geq  \beta {p}^{k},\forall k \in  K \tag{7}
$$

$$
\mathop{\sum }\limits_{{i \in  I}}\mathop{\sum }\limits_{{j \in  {J}_{i}}}{x}_{ij}^{k} + \mathop{\sum }\limits_{{i \in  I}}\mathop{\sum }\limits_{{j \in  {J}_{i}^{ * }}}{\widetilde{x}}_{ij}^{k} + \mathop{\sum }\limits_{{l \in  L}}{w}_{l}^{k} \geq  1,\forall k \in  K \tag{8}
$$

$$
\mathop{\sum }\limits_{{k \in  K}}{x}_{ij}^{k} \leq  1,\forall i \in  I,\forall j \in  {J}_{i} \tag{9}
$$

$$
\mathop{\sum }\limits_{{k \in  K}}{\widetilde{x}}_{ij}^{k} \leq  1,\forall i \in  I,\forall j \in  {J}_{i}^{ * } \tag{10}
$$

$$
\mathop{\sum }\limits_{{k \in  K}}\left( {{x}_{ij}^{k} + {\widetilde{x}}_{ij}^{k}}\right)  \leq  1,\forall i \in  I,\forall j \in  {J}_{i}^{ * } \tag{11}
$$

$$
{\delta }^{k} \geq  {p}^{k} - \mathop{\sum }\limits_{{i \in  I}}\mathop{\sum }\limits_{{j \in  {J}_{i}}}{c}_{t}{x}_{ij}^{k} - \mathop{\sum }\limits_{{i \in  I}}\mathop{\sum }\limits_{{j \in  {J}_{i}^{ * }}}{c}_{t}{\widetilde{x}}_{ij}^{k} - \mathop{\sum }\limits_{{l \in  L}}{c}_{t}{w}_{l}^{k},\forall k \in  K \tag{12}
$$

$$
{\delta }^{k} \geq  0,\forall k \in  K \tag{13}
$$

$$
{x}_{ij}^{k} \in  \{ 0,1\} ,\forall k \in  K,\forall i \in  I,\forall j \in  {J}_{i} \tag{14}
$$

$$
{\widetilde{x}}_{ij}^{k} \in  \{ 0,1\} ,\forall k \in  K,\forall i \in  I,\forall j \in  {J}_{i}^{ * } \tag{15}
$$

$$
{w}_{l}^{k} \in  \left\{  {0,1,2,\ldots ,{n}_{l}^{ * }}\right\}  ,\forall k \in  K,\forall l \in  L \tag{16}
$$

The objective function (1) minimizes the total delay for bus users and rail users,and a weighting parameter $\lambda$ is added for the part of bus users' delay for getting a flexible scheme. Dispatching a running bus directly to a special disrupted station for the bus bridging service causes two parts of delay for the bus users. One is from passengers ${c}_{ij}$ on board having to get off and wait for the next bus. The other is produced by the passengers ${q}_{ij}$ who are about to sequentially take this bus along the route must wait for the next bus, ${q}_{ij} = \max \left\{  {{Q}_{ij} - {a}_{ij},0}\right\}$ . Understandably,when dispatching its replica,the bus will take these bus passengers to their destinations before to the disrupted station, so that there is no delay for bus users no matter they are on board or waiting for being picked up. Delays for rail users are generated by passengers at special disrupted stations waiting for buses to arrive. Furthermore, considering that some passengers may wait for a long time but still fail to get on the expected buses,a penalty function $\gamma \mathop{\sum }\limits_{{k \in  K}}{\delta }^{k}$ is added to the objective function. Constraints (2)-(4) indicates that two adjacent buses on the same bus route cannot be dispatched together. Suppose that the bus $j$ of the bus route $i$ is selected to be a shuttle bus,and the bus $j + 1$ cannot be chosen in order not to excessively disturb bus users. Constraints (5) and (6) ensure the normal operation of regular bus routes after the implementation of the "bus bridging" strategy from the perspective of the average headway and the remaining capacity, respectively. Constraint (5) is obtained by simplifying $\frac{\mathop{\sum }\limits_{{i \in  {I}_{j}}}{h}_{ij}}{{N}_{i} - \mathop{\sum }\limits_{{k \in  K}}\mathop{\sum }\limits_{{j \in  {I}_{j}}}{x}_{ij}^{k} - \mathop{\sum }\limits_{{k \in  K}}\mathop{\sum }\limits_{{j \in  {I}^{ * }}}{\widetilde{x}}_{ij}^{k}} \leq  {h}_{\max }$ . Constraints (7) and (8) limit the minimum number of shuttle buses required to each special disrupted station. Constraints (9) and (10) represent that each bus is permitted to choose only one special disrupted station as the departure stop for the bus bridging service. Constraint (11) indicates that the bus and its replica are essentially one vehicle, and they cannot be dispatched at the same time. Constraints (12) and (13) are the result of linearizing ${\delta }^{k} = \max \left\{  {{p}^{k} - \mathop{\sum }\limits_{{i \in  I}}\mathop{\sum }\limits_{{j \in  {J}_{i}}}{c}_{i}{x}_{ij}^{k} - \mathop{\sum }\limits_{{i \in  I}}\mathop{\sum }\limits_{{j \in  {J}_{i}^{ * }}}{c}_{i}{\widetilde{x}}_{ij}^{k} - \mathop{\sum }\limits_{{l \in  L}}{c}_{l}{w}_{l}^{k},0}\right\}  .$

## 4. Robust optimization model

With complex road conditions, the headway of two adjacent running buses on a bus route is not always equal to the departure interval. Moreover, in our model the headway represents the additional amount of time that the latter bus takes to reach the same bus stop compared to the former bus, and it is also affected by human factors. In practice, operators give drivers specific instructions (slow down or speed up) based on the real-time location of the buses, so that the value of headway always varies within the range of the departure interval. When the headway is larger than the departure interval, it will increase the delay of bus users, and even make our scheme solved by the deterministic model infeasible. Thus, based on the integer programming model in Section 3.3, a robust optimization model is formulated taking into account the uncertainty of ${h}_{ij}$ . The goal of robust optimization is to obtain the optimal solution in the worst case where ${h}_{ij}$ is subject to the uncertainty set. There are abundant research studies on robust optimization theory (Ben-Tal and Nemirovski, 1998). To describe the situation aptly, we adopt the approach proposed by Bertsimas and Sim (2004) to weaken the level of conservatism of the robust model. Additionally, through a series of transformations, a mixed integer programming model is eventually achieved.

<!-- Meanless: 6-->




<!-- Meanless: X. Wang et al. Transportation Research Part C 139 (2022) 103696-->

The cumulative deviation of ${h}_{ij}$ is assumed to be less than the value domain $\widehat{{h}_{ij}}$ ,hence the uncertainty parameter ${h}_{ij}^{ * }$ takes the value in symmetric distribution set $\left\lbrack  {{h}_{ij} - \widehat{{h}_{ij}},{h}_{ij} + \widehat{{h}_{ij}}}\right\rbrack$ . For each bus route $i$ ,a parameter ${\Gamma }_{i}$ is introduced,whose value represents the degree of conservatism of the robust model. ${\Gamma }_{i}$ is given the value in the interval $\left\lbrack  {0,\left| {J}_{i}\right| }\right\rbrack$ . When ${\Gamma }_{i} = \left| {J}_{i}\right|$ ,it means that the headway ${h}_{ij}^{ * }$ of all buses of the bus route $i$ varies within the range of $\left\lbrack  {{h}_{ij} - \widehat{{h}_{ij}},{h}_{ij} + \widehat{{h}_{ij}}}\right\rbrack$ . If ${\Gamma }_{i} = 0$ ,it represents that the headway ${h}_{ij}^{ * }$ is a constant parameter, ${h}_{ij}^{ * } = {h}_{ij}$ ,and the robust model to be deterministic. From Section 3.3,the uncertain parameters exist in formulations (1) and (5). For formulation (1), the worst case of the uncertain term is shown in formulations (17)-(19), where $\left| {S}_{i}\right|  = \left\lfloor  {\Gamma }_{i}\right\rfloor  ,{S}_{i} \subseteq  {J}_{i}$ ,and ${T}_{i} \in  {J}_{i} \smallsetminus  {S}_{i}$ .

$$
\mathop{\sum }\limits_{{k \in  K}}\mathop{\sum }\limits_{{i \in  I}}\mathop{\sum }\limits_{{j \in  {J}_{i}}}\left( {{c}_{ij} + {q}_{ij}}\right) {h}_{ij}{x}_{ij}^{k}
$$

$$
 + \mathop{\sum }\limits_{{i \in  I}}\mathop{\max }\limits_{\left\{  {S}_{i},\left\{  {T}_{i}\right\}  \right\}  }\left( {\mathop{\sum }\limits_{{k \in  K}}\mathop{\sum }\limits_{{j \in  {S}_{i}}}\left( {{c}_{ij} + {q}_{ij}}\right) \widehat{{h}_{ij}}{Y}_{ij}^{k} + \left( {{\Gamma }_{i} - \left\lfloor  {\Gamma }_{i}\right\rfloor  }\right) \left( {{c}_{iT} + {q}_{iT}}\right) \widehat{{h}_{iT}}{Y}_{iT}^{k}}\right)  \tag{17}
$$

$$
 - {Y}_{ij}^{k} \leq  {x}_{ij}^{k} \leq  {Y}_{ij}^{k},\forall k \in  K,\forall i \in  I,\forall j \in  {J}_{i} \tag{18}
$$

$$
{Y}_{ij}^{k} \geq  0,\forall k \in  K,\forall i \in  I,\forall j \in  {J}_{i} \tag{19}
$$

Obviously, formulations (17)-(19) are not linear. The nonlinear part of formulations (17)-(19) is transformed into formulations

(20)-(22) at first, and then the dual problem formulations (23)-(28) of formulations (20)-(22) are considered, which are linear.

$$
\max \mathop{\sum }\limits_{{k \in  K}}\mathop{\sum }\limits_{{j \in  {J}_{i}}}\left( {{c}_{ij} + {q}_{ij}}\right) \left| {x}_{ij}^{k}\right| \overset{⏜}{{h}_{ij}}{\Phi }_{ij},\forall i \in  I \tag{20}
$$

subject to

$$
\mathop{\sum }\limits_{{j \in  {J}_{i}}}{\Phi }_{ij} \leq  {\Gamma }_{i},\forall i \in  I \tag{21}
$$

$$
0 \leq  {\Phi }_{ij} \leq  1,\forall i \in  I,\forall j \in  {J}_{i} \tag{22}
$$

$$
\min {\Gamma }_{i}{\Omega }_{i} + \mathop{\sum }\limits_{{j \in  {J}_{i}}}{\varphi }_{ij},\forall i \in  I \tag{23}
$$

subject to

$$
{\Omega }_{i} + {\varphi }_{ij} \geq  \mathop{\sum }\limits_{{k \in  K}}\left( {{c}_{ij} + {q}_{ij}}\right) \widehat{{h}_{ij}}{Y}_{ij}^{k},\forall i \in  I,\forall j \in  {J}_{i} \tag{24}
$$

$$
{\Omega }_{i} \geq  0,\forall i \in  I \tag{25}
$$

$$
{\varphi }_{ij} \geq  0,\forall i \in  I,\forall j \in  {J}_{i} \tag{26}
$$

$$
 - {Y}_{ij}^{k} \leq  {x}_{ij}^{k} \leq  {Y}_{ij}^{k},\forall k \in  K,\forall i \in  I,\forall j \in  {J}_{i} \tag{27}
$$

$$
{Y}_{ij}^{k} \geq  0,\forall k \in  K,\forall i \in  I,\forall j \in  {J}_{i} \tag{28}
$$

Similarly, for constraint (5), the worst scenario for the uncertainty term is given in formulations (29)-(32). Following the previous steps in formulations (17)-(28), the nonlinear part of formulations (29)-(32) are linearized to obtain formulations (33)-(39).

$$
\frac{\mathop{\sum }\limits_{{j \in  {J}_{i}}}{h}_{ij}{z}_{ij}}{{h}_{\max }} + \frac{1}{{h}_{\max }}\mathop{\sum }\limits_{{i \in  I}}\mathop{\max }\limits_{\left\{  {S}_{i},\left\{  {T}_{i}\right\}  \right\}  }\left( {\mathop{\sum }\limits_{{j \in  {S}_{i}}}\widehat{{h}_{ij}}{y}_{ij} + \left( {{\Gamma }_{i} - \left\lfloor  {\Gamma }_{i}\right\rfloor  }\right) \widehat{{h}_{iT}}{y}_{iT}}\right) ,\forall i \in  I \tag{29}
$$

$$
1 \leq  {z}_{ij} \leq  1,\forall i \in  I,\forall j \in  {J}_{i} \tag{30}
$$

$$
 - {y}_{ij} \leq  {z}_{ij} \leq  {y}_{ij},\forall i \in  I,\forall j \in  {J}_{i} \tag{31}
$$

$$
{y}_{ij} \geq  0,\forall i \in  I,\forall j \in  {J}_{i} \tag{32}
$$

$$
\min {\Gamma }_{i}{v}_{i} + \mathop{\sum }\limits_{{j \in  {J}_{i}}}{\mu }_{ij},\forall i \in  I \tag{33}
$$

subject to

$$
{v}_{i} + {\mu }_{ij} \geq  \overset{⏜}{{h}_{ij}}{y}_{ij},\forall i \in  I,\forall j \in  {J}_{i} \tag{34}
$$

$$
{v}_{i} \geq  0,\forall i \in  I \tag{35}
$$

<!-- Meanless: 7-->




<!-- Meanless: X. Wang et al. Transportation Research Part C 139 (2022) 103696-->

$$
{\mu }_{ij} \geq  0,\forall i \in  I,\forall j \in  {J}_{i} \tag{36}
$$

$$
1 \leq  {z}_{ij} \leq  1,\forall i \in  I,\forall j \in  {J}_{i} \tag{37}
$$

$$
 - {y}_{ij} \leq  {z}_{ij} \leq  {y}_{ij},\forall i \in  I,\forall j \in  {J}_{i} \tag{38}
$$

$$
{y}_{ij} \geq  0,\forall i \in  I,\forall j \in  {J}_{i} \tag{39}
$$

Overall, the robust optimization model can be described as follows, which is a mixed-integer linear programming model.

$$
\min \;\lambda \mathop{\sum }\limits_{{k \in  K}}\mathop{\sum }\limits_{{i \in  I}}\mathop{\sum }\limits_{{j \in  {J}_{i}}}\left( {{c}_{ij} + {q}_{ij}}\right) {h}_{ij}{x}_{ij}^{k} + \lambda \mathop{\sum }\limits_{{i \in  I}}{\Gamma }_{i}{\Omega }_{i} + \lambda \mathop{\sum }\limits_{{i \in  I}}\mathop{\sum }\limits_{{j \in  {J}_{i}}}{\varphi }_{ij}
$$

$$
 + \mathop{\sum }\limits_{{k \in  K}}\mathop{\sum }\limits_{{i \in  I}}\mathop{\sum }\limits_{{j \in  {J}_{i}}}{c}_{t}{t}_{ij}^{k}{x}_{ij}^{k} + \mathop{\sum }\limits_{{k \in  K}}\mathop{\sum }\limits_{{i \in  I}}\mathop{\sum }\limits_{{j \in  {J}_{i}^{ * }}}{c}_{t}{\widetilde{t}}_{ij}^{k}{\widetilde{x}}_{ij}^{k} + \mathop{\sum }\limits_{{k \in  K}}\mathop{\sum }\limits_{{l \in  L}}{c}_{t}{\tau }_{l}^{k}{w}_{l}^{k} + \gamma \mathop{\sum }\limits_{{k \in  K}}{\delta }^{k} \tag{40}
$$

subject to

(2)-(4) & (6)-(16)

$$
\mathop{\sum }\limits_{{k \in  K}}\mathop{\sum }\limits_{{j \in  {J}_{i}}}{x}_{ij}^{k} + \mathop{\sum }\limits_{{k \in  K}}\mathop{\sum }\limits_{{j \in  {J}_{i}^{ * }}}{\widetilde{x}}_{ij}^{k} + \frac{\mathop{\sum }\limits_{{j \in  {J}_{i}}}{h}_{ij}{z}_{ij} + {\Gamma }_{i}{v}_{i} + \mathop{\sum }\limits_{{j \in  {J}_{i}}}{\mu }_{ij}}{{h}_{\max }} \leq  {N}_{i},\forall i \in  I \tag{41}
$$

$$
{\Omega }_{i} + {\varphi }_{ij} \geq  \mathop{\sum }\limits_{{k \in  K}}\left( {{c}_{ij} + {q}_{ij}}\right) \widehat{{h}_{ij}}{Y}_{ij}^{k},\forall i \in  I,\forall j \in  {J}_{i} \tag{42}
$$

$$
{v}_{i} + {\mu }_{ij} \geq  \widehat{{h}_{ij}}{y}_{ij},\forall i \in  I,\forall j \in  {J}_{i} \tag{43}
$$

$$
{\Omega }_{i} \geq  0,\forall i \in  I \tag{44}
$$

$$
{\varphi }_{ij} \geq  0,\forall i \in  I,\forall j \in  {J}_{i} \tag{45}
$$

$$
 - {Y}_{ij}^{k} \leq  {x}_{ij}^{k} \leq  {Y}_{ij}^{k},\forall k \in  K,\forall i \in  I,\forall j \in  {J}_{i} \tag{46}
$$

$$
{Y}_{ij}^{k} \geq  0,\forall k \in  K,\forall i \in  I,\forall j \in  {J}_{i} \tag{47}
$$

$$
{v}_{i} \geq  0,\forall i \in  I \tag{48}
$$

$$
{\mu }_{ij} \geq  0,\forall i \in  I,\forall j \in  {J}_{i} \tag{49}
$$

$$
1 \leq  {z}_{ij} \leq  1,\forall i \in  I,\forall j \in  {J}_{i} \tag{50}
$$

$$
 - {y}_{ij} \leq  {z}_{ij} \leq  {y}_{ij},\forall i \in  I,\forall j \in  {J}_{i} \tag{51}
$$

$$
{y}_{ij} \geq  0,\forall i \in  I,\forall j \in  {J}_{i} \tag{52}
$$

## 5. Case studies

In this section, based on the real-world metro shutdown case in Shanghai, numerical experiments are conducted to test the performance of the proposed method. Firstly, the effectiveness of the deterministic integer programming model is validated, and the results are compared with those from conventional schemes. Secondly, the applicability of the robust optimization model was evaluated against the deterministic model. The integer programming model and robust optimization model are coded in the C++ environment and solved by IBM ILOG CPLEX 12.8 running on a 1.5 GHz Intel Core i7 PC with 16.0 GB RAM.

<!-- Meanless: 8-->




<!-- Meanless: X. Wang et al. Transportation Research Part C 139 (2022) 103696-->

<!-- Media -->

<!-- figureText: Xinzhuang Station Urban rail stations Special disrupted stations Urban rail network Disrupted urban rail segment Yindu Road Station Jianchuan Road Station -->

<img src="https://cdn.noedgeai.com/bo_d2u6glbef24c73b31eng_8.jpg?x=358&y=160&w=987&h=799&r=0"/>

Fig. 4. Case study area.

<!-- figureText: (a) (b) (c) (d) No. 957 Yindu Road Station Jianchuan Road Station Bus stops — Urban rail network - Special disrupted stations Yindu Road Station Yindu Road Station Jianchuan Road Station ${}^{* * }$ -->

<img src="https://cdn.noedgeai.com/bo_d2u6glbef24c73b31eng_8.jpg?x=170&y=1051&w=1368&h=515&r=0"/>

Fig. 5. Generation of the set of candidate bus routes.

<!-- Media -->

### 5.1. Disruption case

There are 15 metro lines and 423 metro stations in Shanghai urban rail transit system until October 2020. The background to this numerical experiment (shown in Fig. 4) is an unplanned disruption of Shanghai Metro Line 5, which lasts for more than 30 min. As a consequence, the metro service between Jianchuan Road station and Xinzhuang station in the upbound direction of Line 5 is shut down and the bus bridging strategy is implemented. Furthermore, at the time of the accident, a train in the upbound direction is stuck nearby the Yindu Road station, where hundreds of stranded passengers are waiting for shuttle buses. The Yindu Road station and Jianchuan Road station are designated as special disrupted stations, which serve as the origins of the shuttles.

The bus routes involved in this emergency response are selected to form a candidate bus route set. The distance between the special disrupted stations and their nearest bus parking lot is approximately ${15}\mathrm{\;{km}}$ ,setting $\mathrm{R} = 5\mathrm{\;{km}}$ . There are ${411}\mathrm{\;{bus}}$ stops (shown in Fig. 5(b)) within the circle, and 142 bus routes passing through these stops. For instance, the bus route No. 957, depicted in Fig. 5(c), is an initial candidate bus route. The 142 bus routes are screened to remove routes that are not in operation or the departure interval is more than ${20}\mathrm{\;{min}}$ . The remaining 97 bus routes constitute a candidate bus route set,as presented in Fig. 5(d).

<!-- Meanless: 9-->




<!-- Meanless: X. Wang et al. Transportation Research Part C 139 (2022) 103696-->

<!-- Media -->

Table 2

Values of some parameters in the numerical experiment.

<table><tr><td>Parameter</td><td>${h}_{\max }$</td><td>${c}_{\max }$</td><td>${c}_{t}$</td><td>$\alpha$</td><td>$\beta$</td><td>$\lambda$</td><td>$\gamma$</td></tr><tr><td>Value</td><td>30 min</td><td>70</td><td>60</td><td>0.75</td><td>0.7</td><td>1.0</td><td>50</td></tr></table>

<!-- figureText: (a) (b) Yindu Road Station Jianchuan Road Station Yindu Road Station Jianchuan Road Station -->

<img src="https://cdn.noedgeai.com/bo_d2u6glbef24c73b31eng_9.jpg?x=186&y=327&w=1335&h=681&r=0"/>

Fig. 6. Maps showing the bus dispatching for two methods (optimized response; standard response).

<!-- figureText: Optimized Response Response Time (min) 15 10 5 0 17 18 5 6 8 9 10 12 13 Bus to Yindu Road Station Response Time (min) Standard Response 5 7 8 10 11 12 14 15 16 Bus to Jianchuan Road Station -->

<img src="https://cdn.noedgeai.com/bo_d2u6glbef24c73b31eng_9.jpg?x=190&y=1101&w=1327&h=331&r=0"/>

Fig. 7. Response time of each bus for two methods (optimized response; standard response).

<!-- Media -->

Snapshotting at the start of the disturbance,there are 398 buses operating on 97 bus routes. The basic bus information ${h}_{ij},{c}_{\max }$ and bus passenger data ${c}_{ij},{q}_{ij},{a}_{ij}$ are provided by the Shanghai bus company,and the metro passenger data ${p}^{k}$ is obtained from the Shanghai metro operating company. The location information of bus stops, bus parking lots, and metro stations is crawled from Amap (a Chinese map software which is similar to Google Maps), converted to coordinates, and then visualized with Quantum GIS software. The feasible route network for the bus in Shanghai is crawled from OpenStreetMap. Afterward, the algorithm proposed by Boeing (2017) is utilized to calculate the actual shortest path for each bus to reach the special disrupted station, with the minimum travel time as the criterion. The length of each shortest path is measured as the actual distance traveled, assuming the speed of the bus is ${30}\mathrm{\;{km}}/\mathrm{h}$ ,and the values of ${t}_{ij}^{k},{\tau }_{ij}^{k},{\tau }_{l}^{k}$ are generated. The remaining parameter settings for the numerical experiment are listed in Table 2.

### 5.2. Effectiveness of integer programming model

To assess the effectiveness of the method proposed in this paper, we compare it with the standard dispatching scheme. The standard scheme is to dispatch spare buses from bus route terminus or bus parking lots as shuttle buses (Itani et al., 2020). When the disruption occurs at 11:00, the dispatching scheme obtained by the model in Section 3.3 is shown in Fig. 6(a). Similarly, Fig. 6(b) illustrates the results gained from the standard scheme in the most favorable scenario, when spare buses and drivers at bus route terminals and parking lots are available in sufficient quantity. Fig. 6 shows the dispatching scheme on a real map. The nodes indicate the selected buses and the lines represent the dispatch routes, which are the shortest path for the selected buses to reach the corresponding stations. Fig. 7 compares the response time required for the selected bus to the special disrupted station. Both methods dispatch the same number of buses. However, using the method proposed in this paper, the arrival time of the first bus is shortened from 10 min to 1 min (optimization ratio = 90%, Jianchuan Road Station) and 9 min to 1 min (89%, Yindu Road Station). Similarly,the time for the last bus is reduced from 16 min to 6 min (63%, Jianchuan Road Station) and 11 min to 8 min (27%, Yindu Road Station). At the same time, total users' delay (Total users' delay = Bus users' delay + Rail users' delay) decreases from 22,380 passenger minutes to 12,313 passenger minutes (45%), and the average delay for passengers drops from 12 minutes/passenger to 5 minutes/passenger (58%).

<!-- Meanless: 10-->




<!-- Meanless: X. Wang et al. Transportation Research Part C 139 (2022) 103696-->

<!-- Media -->

<!-- figureText: (a) (b) Selected buses Bus parking lot Urban rail stations The shortest path Urban rail network Disrupted urban rail segment Yindu Road Station Jianchuan Road Station Yindu Road Station Jianchuan Road Station -->

<img src="https://cdn.noedgeai.com/bo_d2u6glbef24c73b31eng_10.jpg?x=202&y=155&w=1300&h=809&r=0"/>

Fig. 8. Map showing the bus dispatching at peak hours (09:00).

<!-- figureText: 30 Optimized Response 30 Response Time (min) 10 4 9 16 Response Time (min) Optimized Response (No Replicas) 20 0 7 12 I 14 16 19 21 -->

<img src="https://cdn.noedgeai.com/bo_d2u6glbef24c73b31eng_10.jpg?x=208&y=1059&w=1288&h=318&r=0"/>

Fig. 9. Response time of each bus at peak hours (09:00).

<!-- Media -->

In general, compared to the conventional scheme, our method significantly reduces the total users' delays. With our method, the arrival time of the first shuttle bus is noticeably shortened, so that the subsequent scheme can be quickly activated. It plays an important role in alleviating the anxiety of stranded metro users.

#### 5.3.Bus dispatching at peak hours

When the interruption of urban rail transit occurs in the morning rush hour of a workday (09:00), the outcome derived from applying the model in Section 3.3 is given in Fig. 8(a). At this point, the remaining capacity of the operating buses is not sufficient to support the entire bus bridging task, so it is necessary to transfer the standby bus from the nearest bus parking lot. In addition, most of the dispatched buses choose to drive to terminals to finish their pre-designated trips before undertaking the bus bridge task. To assess the impact of this strategy on the dispatching method, we compare it with the dispatching scheme without replicas, in which all running buses must directly drive to metro stations for the bus bridging service. When the interruption occurs at 11:00, the dispatching scheme without replicas is the same as the scheme proposed in this paper, as shown in Fig. 6(a). However, when the interruption occurs at 09:00, the two schemes are quite different, and Fig. 8(b) illustrates the results obtained from the scheme without replicas. Fig. 9 shows the running time of buses from the bus stop to the metro station under two dispatching schemes. In the scheme without replicas, 5 of the 21 buses dispatched to Jianchuan Road Station and 1 of the 19 buses deployed to Yindu Road Station are spare buses from bus parking lots. Moreover, 15 of the 21 buses and 12 of the 19 buses are running buses close to their terminals. Nevertheless, in our scheme, only 1 of the 21 buses dispatched to Jianchuan Road Station is the spare bus. Furthermore, 18 of the 21 buses and 18 of the 19 buses are replicas. It is observed that the average response time of all buses increases from 10.35 min (dispatching scheme without replicas) to 15.05 min (dispatching scheme with replicas),but total users’ delay decreases from 57,680 passenger minutes to 41,072 passenger minutes.

<!-- Meanless: 11-->




<!-- Meanless: X. Wang et al. Transportation Research Part C 139 (2022) 103696-->

<!-- Media -->

<!-- figureText: (a) 20000 (b) 5 40000 Users' Delay (min) 30000 Number of Spare Buses 20000 10000 0 0 1 3 Value of Lamda Bus Users' Delay Number of Spare Buses 17500 Rail Users' Delay Users' Delay (min) 15000 Number of Spare Buses 12500 7500 5000 2500 1 2 4 Value of Lamda -->

<img src="https://cdn.noedgeai.com/bo_d2u6glbef24c73b31eng_11.jpg?x=208&y=159&w=1285&h=440&r=0"/>

Fig. 10. Results of integer programming model under different $\lambda \left( {{11} : {00};{09} : {00}}\right)$ .

<!-- Media -->

In general, when dispatching buses at peak hours, this strategy is very effective, where allowing running buses to finish their designated trips first and launch emergency service. Although the average dispatch time of buses is longer under this strategy, over ${55}\%$ of the buses can reach the special disrupted station within ${15}\mathrm{\;{min}}$ ,which ensures the emergency response strategy is conducted. In addition, it reduces the total delay of users, especially bus users, so that the dissatisfaction of bus users is alleviated. It even increases the utilization of surplus capacity on operating buses, thus reducing the use of spare buses and the cost of emergency response.

### 5.4. Sensitivity analysis

The real-time bus dispatching method causes extra delays to some bus passengers. In the process of making the dispatch plan, we can adjust the value of parameter $\lambda$ to maintain the original service level of buses as much as possible.

To investigate the effect of the parameter $\lambda$ on the dispatching strategy,the results of the integer programming model are analyzed under different scenarios. Fig. 10(a) and 10(b) illustrate the delays in the scenarios with $\lambda$ of values $\{ 1,2,3,4\}$ ,when disruptions occur at 11:00 and 09:00. During off-peak hours (11:00), the load factor of buses is low, and the remaining capacity of operating buses is sufficient to support the bus bridging service. As the value of $\lambda$ increases,it tends to dispatch operating buses close to the terminals, or even allow buses to finish their designated trips first and then provide the service. In the rush hour (09:00), the growth of $\lambda$ brings a significant alteration in the scheme,preferring to make all operating buses drive to their terminals and then to disrupted stations,and dispatching some spare buses from parking lots as supplement. A higher value of $\lambda$ represents a greater focus on the service level for bus passengers when generating the scheduling plan. Thus, vehicles contributing less delay to bus riders would be dispatched as shuttle buses as far as possible.

### 5.5. Effectiveness of robust optimization model

To evaluate the validity of the robust model in Section 4,some numerical experiments are done. First,we set ${\Gamma }_{i} = \left| {J}_{i}\right| /2$ ,that is, the headway of half of the buses of the bus route $i$ is uncertain,and the headway of the remaining buses is constant. The uncertainty level represents the value of $\widehat{{h}_{ij}}$ ,and when the uncertainty level is 0.2,denoting $\widehat{{h}_{ij}} = {0.2}{h}_{ij}$ .

To investigate the performance of the solutions, numerical tests are carried out for two different uncertainty levels (uncertainty level $= {0.2}\& {0.8}$ ). With ${\Gamma }_{i} = \left| {J}_{i}\right| /2$ ,the solution of the robust model is referred to as RS. Similarly,the solution of the deterministic model is called DS. At each uncertainty level,200 groups of headway ${h}_{ij}^{ * }$ are randomly generated in the uncertainty sets. We calculated the total users' delay of two solutions (RS&DS) in 200 headway scenarios, the results are exhibited in Fig. 11(a). Fig. 11(a) is a box plot that displays the median, lower quartile, upper quartile, minimum and maximum values. It can be seen that when the uncertainty level is 0.2 , the range of delays obtained in RS is [11570, 13335] and in DS is [11144, 13698]. While the uncertainty level is 0.8 , they are [10740, 16358] and [7493, 20802]respectively. It is noted that RS has a narrower interval of variation compared to DS. The delay obtained by the RS is also shorter than that of the DS when the headway is in the worst case. Moreover, DS is potentially infeasible in 200 sets of numerical experiments, with 17 scenarios infeasible at uncertainty levels of 0.2 and 49 scenarios when the level is set to 0.8 . The rate of infeasibility for the deterministic model is increased in the higher uncertainty levels. Thus, using the robust model for high uncertainty levels is quite acceptable in these cases.

<!-- Meanless: 12-->




<!-- Meanless: X. Wang et al. Transportation Research Part C 139 (2022) 103696-->

<!-- Media -->

<!-- figureText: (a) Robust (b) 35 Robust Optimization Ratio Deterministic 30 Optimization Ratio(%) 5 0 0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1 Uncertainity Level 24000 20000 Deterministic Total Users' Delay(min) 18000 22000 Total Users' Delay(min) 20000 18000 16000 14000 16000 14000 12000 10000 12000 8000 10000 0.2 0.8 Uncertainity Level -->

<img src="https://cdn.noedgeai.com/bo_d2u6glbef24c73b31eng_12.jpg?x=207&y=159&w=1288&h=533&r=0"/>

Fig. 11. Results of numerical experiments.

Table 3

Average computation time of the approach (sec).

<table><tr><td>Case</td><td>Integer programming model</td><td>Robust optimization model</td></tr><tr><td>Case 1 (11:00)</td><td>0.44</td><td>0.61</td></tr><tr><td>Case 2 (09:00)</td><td>0.42</td><td>0.67</td></tr></table>

<!-- Media -->

Fig. 11(b) shows the results of the robust model versus the deterministic model for different uncertainty levels when the uncertainty parameter is in the worst scenario of 200 sets numerical experiments. As the uncertainty level increases, the optimization ratio of the robust model rises gradually. When the uncertainty level is equal to 1.0 , compared with the deterministic model, the scheduling solution solved by the robust model leads to a 29.8% reduction in total users’ delay.

In general, the solution solved by the robust model outperforms the deterministic model numerically in the worst cases and fluctuates slightly.

### 5.6. Computational performance

The computational challenge is weakened because of the well-designed variable and constraints setting, as well as the tightened feasible region. The gap between the feasible region of the integer programming model and that of its linear relaxation model is narrow, which facilitates the branch-and-bound algorithm to improve the solving efficiency. Table 3 shows the computation time of the solution approach. As can be seen,both test cases are solved very efficiently. With the solution time no more than ${0.5}\mathrm{\;s}$ for the deterministic model and ${0.7}\mathrm{\;s}$ for the robust optimization model,the proposed method can be carried out in a computationally efficient way, even in unplanned disruptions where a rapid response is required.

## 6. Conclusions

This paper proposes a real-time bus dispatching method for unplanned urban rail disruptions taking into account the source of shuttle buses and bus bridging task allocation, which is a significantly complex decision-making process. We aim to minimize the total delays of metro passengers and bus riders by dispatching running buses and spare buses to undertake bus bridging services given limited vehicle resources. The optimal solution presents a complete bus dispatching plan, consisting of determining the number of buses to be dispatched, choosing which route the bus comes from and which metro station it serves, as well as assigning tasks between running buses and spare buses. We develop an integer programming model and a robust optimization model for the problem. Real-world case studies based on a Shanghai metro disruption, as well as a rich set of synthetic test cases, are conducted in numerical experiments. Results suggest the following: (a) our method significantly reduces the total users' delay compared to only using spare vehicles for bus bridging services; (b) the arrival time of the first shuttle bus is noticeably shortened, which plays an important role in alleviating the anxiety of stranded metro users; (c) the robust optimization model offers a more reliable and competitive solution when the headway of the bus varies widely; (d) the proposed method can be carried out in a computationally efficient way, even in unplanned disruptions where a rapid response is required.

To the best of our knowledge, the literature on real-time bus dispatching is still in its infancy, though it is an essential part of emergency response. Possible future research in the related field can be carried out. For example, passenger flow forecasting can be integrated into our model to eliminate the variation of the number of stranded passengers as time flows, thus increasing the applicability and flexibility of the schemes. This makes it possible to further improve the performance of the recovery strategy.

<!-- Meanless: 13-->




<!-- Meanless: X. Wang et al. Transportation Research Part C 139 (2022) 103696-->

## CRediT authorship contribution statement

Xiaohan Wang: Conceptualization, Methodology, Software, Validation, Writing - original draft. Jian Gang Jin: Conceptualization, Methodology, Writing - review & editing, Supervision, Funding acquisition. Lijun Sun: Conceptualization, Writing - review & editing.

## Acknowledgments

This work is supported by the National Natural Science Foundation of China [Grant 72061127003, 72122014, 71771149, 71831008], and National Key Research and Development Program of China [Grant 2020AAA0107600]. The second author gratefully acknowledges the support by Shanghai Rising-Star Program, China. References

Bates, J., Polak, J., Jones, P., Cook, A., 2001. The valuation of reliability for personal travel. Transp. Res. Pt. E-Logist. Transp. Rev. 37 (2-3), 191-229. Ben-Tal, A., Nemirovski, A., 1998. Robust convex optimization. Math. Oper. Res. 23 (4), 769-805. Bertsimas, D., Sim, M., 2004. The price of robustness. Oper. Res. 52 (1), 35-53. Binder, S., Maknoon, Y., Bierlaire, M., 2017. The multi-objective railway timetable rescheduling problem. Transp. Res. Pt. C-Emerg. Technol. 78, 78-94. Boeing, G., 2017. OSMnx: New methods for acquiring, constructing, analyzing, and visualizing complex street networks. Comput. Environ. Urban Syst. 65, ${126} - {139}$ .

Chen, Y., An, K., 2021. Integrated optimization of bus bridging routes and timetables for rail disruptions. Eur. J. Oper. Res. 295 (2), 484-498.

Currie, G., Muir, C., 2017. Understanding passenger perceptions and behaviors during unplanned rail disruptions. Transp. Res. Procedia 25, 4392-4402.

De-Los-Santos, A., Laporte, G., Mesa, J.A., Perea, F., 2012. Evaluating passenger robustness in a rail transit network. Transp. Res. Pt. C-Emerg. Technol. 20 (1, SI), 34-46.

Diab, E., Shalaby, A., 2018. Subway service down again assessing the effects of subway service interruptions on local surface transit performance. Transp. Res. Rec. 2672 (8), 443-454.

Dou, X., Wang, H., Meng, Q., 2019. Parallel shuttle bus service design for planned mass rapid transit shutdown: The Singapore experience. Transp. Res. Pt. C-Emerg. Technol. 108, 340-356.

Eltved, M., Breyer, N., Ingvardson, J.B., Nielsen, O.A., 2021. Impacts of long-term service disruptions on passenger travel behaviour: A smart card analysis from the greater copenhagen area. Transp. Res. Pt. C-Emerg. Technol. 131 (43), 1-16.

Gkiotsalitis, K., van Berkum, E.C., 2020. An exact method for the bus dispatching problem in rolling horizons. Transp. Res. Pt. C-Emerg. Technol. 110 (23), 143-165.

Gu, W., Yu, Ji, Y., Ji, Y., Zheng, Y., Zhang, H.M., 2018. Plan-based flexible bus bridging operation strategy. Transp. Res. Pt. C-Emerg. Technol. 91, 209-229.

Guihaire, V., Hao, J.-K., 2008. Transit network design and scheduling: A global review. Transp. Res. Pt. A-Policy Pract. 42 (10), 1251-1273.

Hamedmoghadam, H., Vu, H.L., Jallil, M., Saberi, M., Stone, L., Hoogendoorn, S., 2021. Automated extraction of origin-destination demand for public transportation from smartcard data with pattern recognition. Transp. Res. Pt. C-Emerg. Technol. 129 (24), 1-24.

Hou, B., Cao, Y., Lv, D., Zhao, S., 2020. Transit-based evacuation for urban rail transit line emergency. Sustainability 12 (9), 3919.

Itani, A., Srikukenthiran, S., Shalaby, A., 2020. Capacity-constrained bus bridging optimization framework. Transp. Res. Rec. 2674 (5), 600-612.

Jin, J.G., Teo, K.M., Odoni, A.R., 2016. Optimizing bus bridging services in response to disruptions of urban transit rail networks. Transp. Sci. 50 (3), 790-804.

Kang, L., Chen, S., Meng, Q., 2019. Bus and driver scheduling with mealtime windows for a single public bus route. Transp. Res. Pt. C-Emerg. Technol. 101, ${145} - {160}$ .

Kepaptsoglou, K., Karlaftis, M., 2009. Transit route network design problem: Review. J. Transp. Eng. 135 (8), 491-505.

Lane, B.W., 2008. Significant characteristics of the urban rail renaissance in the united states: A discriminant analysis. Transp. Res. Pt. A-Policy Pract. 42 (2), 279-295.

Lei, D., Chen, X., Cheng, L., Zhang, L., Wang, P., Wang, K., 2021. Minimum entropy rate-improved trip-chain method for origin-destination estimation using smart card data. Transp. Res. Pt. C-Emerg. Technol. 130 (17), 1-17.

Leng, N., Corman, F., 2020. The role of information availability to passengers in public transport disruptions: An agent-based simulation approach. Transp. Res. Pt. A-Policy Pract. 133, 214-236.

Li, B., Yao, E., Yamamoto, T., Tang, Y., Liu, S., 2020. Exploring behavioral heterogeneities of metro passenger's travel plan choice under unplanned service disruption with uncertainty. Transp. Res. Pt. A-Policy Pract. 141 (13), 294-306.

Liang, J., Wu, J., Qu, Y., Yin, H., Qu, X., Gao, Z., 2019. Robust bus bridging service design under rail transit system disruptions. Transp. Res. Pt. E-Logist. Transp. Rev. 132, 97-116.

Meng, L., Zhou, X., 2011. Robust single-track train dispatching model under a dynamic and stochastic environment: A scenario-based rolling horizon solution approach. Transp. Res. Pt. B-Methodol. 45 (7), 1080-1102.

Peeta, S., Mahmassani, H., 1995. Multiple user classes real-time traffic assignment for online operations: a rolling horizon solution framework. Transp. Res. Pt. C-Emerg. Technol. 3 (2), 83-98.

Pender, B., Currie, G., Delbosc, A., Shiwakoti, N., 2014. International study of current and potential social media applications in unplanned passenger rail disruptions. Transp. Res. Rec. 2419 (1), 118-127.

Pender, B., Currie, G., Shiwakoti, N., Delbosc, A., 2015. Economic viability of bus bridging reserves for fast response to unplanned passenger rail disruption. Transp. Res. Rec. 2537, 13-22.

Tan, Z., Xu, M., Meng, Q., Li, Z.-C., 2020. Evacuating metro passengers via the urban bus system under uncertain disruption recovery time and heterogeneous risk-taking behaviour. Transp. Res. Pt. C-Emerg. Technol. 119 (13), 1-20.

Wang, J., Yuan, Z., Yin, Y., 2019. Optimization of bus bridging service under unexpected metro disruptions with dynamic passenger flows. J. Adv. Transp. 2019, $1 - {13}$ .

Zhang, S., Lo, H.K., Ng, K.F., Chen, G., 2021. Metro system disruption management and substitute bus service: a systematic review and future directions. Transp. Rev. 41 (2), 230-251.

Zhu, Y., Goverde, R.M.P., 2019. Dynamic passenger assignment for major railway disruptions considering information interventions. Netw. Spat. Econ. 19 (4), 1249-1279.

Zhu, Y., Goverde, R.M.P., 2021. Dynamic railway timetable rescheduling for multiple connected disruptions. Transp. Res. Pt. C-Emerg. Technol. 125 (26), 1-26.

<!-- Meanless: 14-->

